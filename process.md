# iflist02.py 프로세스 분석

## 프로그램 개요
이 프로그램은 SQLite 데이터베이스에서 특정 조건에 맞는 데이터를 추출하여 가공한 후 Excel 파일로 출력하는 작업을 수행합니다. 주요 기능은 'LY'와 'LZ' 문자열이 포함된 행을 찾아 관련 데이터를 재정렬하고, 특정 조건에 맞는 행을 노란색으로 표시하는 것입니다.

## 처리 프로세스

### 1. 초기 설정
- SQLite DB 파일명 (info.sqlite)과 테이블명 (list) 설정
- 대상 컬럼명 설정: '컬럼B', '컬럼C', '컬럼D'
- 검색 및 대체 문자열 정의:
  - 'LY'를 'LH'로 대체
  - 'LZ'를 'VO'로 대체
- 출력 Excel 파일명 설정: 스크립트 이름 + "_reordered_v2.xlsx" (버전 표시)

### 2. 데이터베이스에서 데이터 추출
- SQLite 데이터베이스에 연결
- **원본 전체 데이터 로드**: 테이블의 모든 행을 df_complete_table로 로드
- **초기 필터링 적용**: 컬럼B 또는 컬럼C에 'LY' 또는 'LZ'가 포함된 행만 df_filtered로 추출
- 문자열 변환 및 NaN 처리를 통한 안전한 필터링 로직 적용

### 3. 데이터 가공 및 재정렬
- 필수 컬럼 존재 여부 확인 (df_filtered와 df_complete_table 모두에서 확인)
- df_filtered의 각 행에 대해 다음 처리 수행:
  1. 원본 행을 output_rows_info 리스트에 추가 (노란색 표시 없음)
  2. 현재 행의 컬럼D 값과 동일한 값을 가진 다른 행들을 **원본 전체 테이블(df_complete_table)에서** 검색
  3. 추가 필터링 조건 적용:
     - 컬럼B에서 'LY'를 'LH'로 또는 'LZ'를 'VO'로 변환했을 때 다른 행의 컬럼B와 일치하는지 확인
     - 컬럼C에서 'LY'를 'LH'로 또는 'LZ'를 'VO'로 변환했을 때 다른 행의 컬럼C와 일치하는지 확인
  4. 조건을 만족하는 행을 output_rows_info에 추가하고 노란색 표시 플래그 설정

### 4. 최종 DataFrame 생성
- output_rows_info의 데이터를 기반으로 최종 DataFrame(df_excel_output) 생성
- 컬럼 순서 유지를 위해 원본 테이블의 컬럼 정보 활용
- 노란색으로 표시할 행의 인덱스 리스트 생성

### 5. Excel 파일 생성 및 스타일 적용
- xlsxwriter 엔진을 사용하여 Excel 파일 생성
- 'ProcessedData' 시트에 데이터 저장
- 조건에 맞는 행에 노란색 배경 적용
- 컬럼 너비 자동 조절 (가독성 향상)
- 결과 파일 저장

## 주요 조건 및 로직
1. **초기 필터링**: 컬럼B 또는 컬럼C에 'LY' 또는 'LZ'가 포함된 행 추출
2. **행 매칭 조건**:
   - 컬럼D 값이 동일(공백 제거 후)
   - 컬럼B에서 'LY'→'LH' 또는 'LZ'→'VO' 변환 후 일치
   - 또는 컬럼C에서 'LY'→'LH' 또는 'LZ'→'VO' 변환 후 일치
3. **출력 형식**: 원본 행 뒤에 매칭된 행을 배치하고, 매칭된 행은 노란색으로 표시

## 개선된 기능
1. **전체 데이터 활용**: 원본 전체 테이블(df_complete_table)을 로드하여 더 많은 데이터와 비교 가능
2. **안전한 데이터 처리**: 
   - 데이터프레임 복사본 생성으로 원본 데이터 보존
   - 문자열 변환 및 NaN 처리를 통한 안전한 필터링
3. **컬럼 순서 유지**: 원본 테이블의 컬럼 순서를 최종 결과물에도 적용
4. **상세한 오류 메시지**: 다양한 상황에 대한 구체적인 오류 메시지 제공

## 예외 처리
- 데이터베이스 연결 오류 처리
- 원본 테이블 데이터 없음 처리
- 필터링 결과 없음 처리
- 필수 컬럼 존재 여부 확인 (df_filtered와 df_complete_table 모두)
- Excel 파일 저장 시 예외 처리
- 필요 라이브러리(xlsxwriter) 미설치 시 안내 메시지 출력
